# 计算机硬件组成

## 1. 计算机硬件概述

计算机的基本硬件系统由运算器、控制器、存储器、输入设备和输出设备5大部件组成。

- **中央处理单元（CPU）**：运算器、控制器等部件集成在一起，是硬件系统的核心，负责数据加工处理，完成算术/逻辑运算及控制功能。
- **存储器**：分内部存储器（速度快、容量小、临时存储）和外部存储器（容量大、速度慢、长期保存）。
- **外部设备**：输入设备（输入数据/命令）和输出设备（输出运行结果）的统称。

## 2. 中央处理单元（CPU）

### 2.1 CPU功能

1. **程序控制**：通过执行指令控制程序执行顺序
2. **操作控制**：产生操作信号控制部件按指令要求操作
3. **时间控制**：对操作进行时间控制。严格控制操作信号的出现时间、持续时间及顺序
4. **数据处理**：进行算术/逻辑运算加工数据，是CPU最根本任务

还需要对系统内部和外部的中断（异常）做出响应，进行相应的处理。

### 2.2 CPU组成

由运算器、控制器、寄存器组和内部总线组成：

#### 2.2.1 运算器
- **算术逻辑单元ALU**：实现算术和逻辑运算
- **累加寄存器AC**：存放运算结果或源操作数
- **数据缓冲寄存器DR**：暂存内存指令或数据
- **状态条件寄存器PSW**：保存指令运行结果条件码（如溢出标志）

执行所有的算术运算、所有的逻辑运算并进行逻辑测试

#### 2.2.2 控制器
- **指令寄存器IR**：暂存当前正在执行的CPU执行指令
- **程序计数器PC**：用于存放即将执行的下一条指令的地址。在指令周期开始时，CPU会使用PC中的地址来定位内存中的指令，并将其加载到指令寄存器（IR）中准备执行。之后，PC会更新为下一条指令的地址，以便于顺序执行后续指令。如果遇到跳转、分支等控制流指令，PC的值会被修改成目标指令的地址。
- **地址寄存器AR**：保存当前CPU访问的内存地址
- **指令译码器ID**：分析指令操作码

CPU依据指令周期的不同阶段来区分二进制的指令和数据。

## 3. 校验码

### 3.1 码距

编码中从一个编码转换为另一个编码需改变的位数。如A:00→B:11，码距为2。码距越大越利于检错纠错。

### 3.2 奇偶校验码

增加1位校验位使编码中1的个数为奇数（奇校验）或偶数（偶校验），码距变为2。

- **奇校验**：编码中，含有奇数个1，发送给接收方，接收方收到后，会计算收到的编码有多少个1，如果是奇数个，则无误，是偶数个，则有误。
- **偶校验**：类似奇校验，但要求编码中1的个数为偶数
- 只能检1位错，无法纠错

### 3.3 CRC校验码

CRC只能检错，不能纠错。使用CRC编码，需要先约定一个生成多项式G(x)。生成多项式的最高位和最低位必须是1。假设原始信息有m位，则对应多项式M(x)。生成校验码思想就是在原始信息位后追加若干校验位，使得追加的信息能被G(x)整除。接收方接收到带校验位的信息，然后用G(x)整除。余数为0，则没有错误；反之则发生错误。

#### 3.3.1 CRC校验码计算步骤
1. 确定数据信息和生成多项式
2. 数据左移k位（k为生成多项式阶数）
3. 模2除法求余数（校验位）
4. 组合数据和余数得到CRC码

**详细示例**：假设原始信息串为10110，CRC的生成多项式为G(x)=x⁴+x+1，求CRC校验码。

1. **在原始信息位后面添0**：假设生成多项式的阶为r，则在原始信息位后添加r个0。本题中，G(x)阶为4，则在原始信息串后加4个0，得到的新串为101100000，作为被除数。
2. **由多项式得到除数**：多项式中x的幂指数存在的位置1，不存在的位置0。本题中，x的幂指数为0,1,4的变量都存在，而幂指数为2,3的不存在，因此得到串10011。
3. **生成CRC校验码**：将前两步得出的被除数和除数进行模2除法运算（即不进位也不借位的除法运算）。

**模2除法运算规则**：不进位也不借位，1-0=1；0-1=1；1-1=0；0-0=0；

```
101100000 ÷ 10011 = 10110 余 00101 → CRC码：1011000101
```

### 3.4 考试真题解析

#### 题目1
**CPU执行算术/逻辑运算时，源操作数和结果暂存在（ ）**
A.程序计数器(PC)  B.累加器(AC)  C.指令寄存器(IR)  D.地址寄存器(AR)

**答案：B**
解析：累加寄存器(AC)用于暂存运算过程中的操作数和结果。

#### 题目2
**执行CPU指令时，需先将指令地址送到地址总线，该地址存于（ ）**
A.指令寄存器(IR)  B.通用寄存器(GR)  C.程序计数器(PC)  D.状态寄存器(PSW)

**答案：C**
解析：程序计数器(PC)存放即将执行的下一条指令地址。

#### 题目3
**数据1100，生成多项式X³+X+1(1011)，CRC编码为（ ）**
A.11000010  B.1011010  C.1100011  D.1011110

**答案：A**
解析：1100左移3位→1100000，模2除1011余001 → CRC码11000010

## 4. 指令系统

### 4.1 指令的组成
一条指令由操作码和操作数两部分组成：
- **操作码**：决定要完成的操作（如加法、减法等）
- **操作数**：指参加运算的数据及其所在的单元地址

在计算机中，操作码和操作数地址都由二进制数码表示，分别称为操作码和地址码，整条指令以二进制编码的形式存放在存储器中。

### 4.2 指令的执行过程
计算机指令执行过程分为三个步骤：
1. **取指令**：程序计数器PC中的指令地址送入地址总线，CPU依据该地址从内存中取出指令内容存入指令寄存器IR
2. **分析指令**：由指令译码器分析操作码
3. **执行指令**：取出指令执行所需的源操作数并执行操作

### 4.3 指令寻址方式

#### 4.3.1 顺序寻址方式
当执行一段程序时，一条指令接着一条指令地顺序执行，由程序计数器PC自动给出下一条指令的地址。

#### 4.3.2 跳跃寻址方式
下一条指令的地址不由程序计数器给出，而是由本条指令直接给出。程序跳转后，按新的指令地址开始顺序执行，程序计数器的内容也必须相应改变以跟踪新的指令地址。

#### 4.3.3 主要寻址方式类型
- **立即寻址**：指令的地址字段指出的不是地址，而是操作数本身
- **直接寻址**：在指令的地址字段中直接指出操作数在主存中的地址
- **间接寻址**：指令地址字段所指向的存储单元中存储的是操作数的地址
- **寄存器寻址**：地址码是寄存器的编号
- **基址寻址**：将基址寄存器的内容加上指令中的形式地址形成操作数的有效地址
- **变址寻址**：将变址寄存器的内容加上指令中的形式地址形成操作数的有效地址

### 4.4 CISC与RISC

#### 4.4.1 基本概念
- **CISC（复杂指令系统）**：兼容性强，指令繁多、长度可变，由微程序实现
- **RISC（精简指令系统）**：指令少，使用频率接近，主要依靠硬件实现（通用寄存器、硬布线逻辑控制）

#### 4.4.2 二者区别
| 指令系统类型 | 指令 | 寻址方式 | 实现方式 | 其它 |
|------------|------|---------|---------|------|
| CISC（复杂） | 数量多，使用频率差别大，可变长格式 | 支持多种 | 微程序控制技术（微码） | 研制周期长 |
| RISC（精简） | 数量少，使用频率接近，定长格式，大部分为单周期指令，操作寄存器，只有Load/Store操作内存 | 支持方式少 | 增加了通用寄存器；优化编译，有硬布线逻辑控制为主；适合采用流水线 | 有效支持高级语言 |

### 4.5 指令流水线

#### 4.5.1 流水线原理
将指令分成不同阶段，每段由不同的硬件部分处理，从而实现多条指令的重叠执行。

#### 4.5.2 流水线性能指标
- **流水线周期**：指令分成不同执行段，其中执行时间最长的段为流水线周期
- **流水线执行时间**：1条指令总执行时间 +（总指令数-1）×流水线周期
- **吞吐率计算**：指令条数/流水线执行时间
- **加速比计算**：不使用流水线执行时间/使用流水线执行时间

### 4.6 考试真题解析

#### 题目1
**Flynn分类法根据计算机在执行程序的过程中（ ）的不同组合，将计算机分为4类。当前主流的多核计算机属于（ ）计算机。**
A.指令流和数据流
B.数据流和控制流
C.指令流和控制流
D.数据流和总线带宽

A.SISD
B.SIMD
C.MISD
D.MIMD

**答案：第一空选A，第二空选D**
解析：
- Flynn分类法根据指令流和数据流的不同组合将计算机分为4类
- 多核计算机属于多指令流多数据流（MIMD）类型，每个核心可独立执行不同指令并操作不同数据

#### 题目2
**以下关于复杂指令集计算机(Complex Instruction Set Computer,CISC)的叙述中，正确的是（ ）。**
A.只设置使用频率高的一些简单指令，不同指令执行时间差别很小
B.CPU中设置大量寄存器，利用率低
C.常采用执行速度更快的组合逻辑实现控制器
D.指令长度不固定，指令格式和寻址方式多

**答案：D**
解析：CISC指令系统特点包括指令长度不固定、指令格式和寻址方式多，通过复杂指令完成复杂任务，由微程序实现。

#### 题目3
**流水线的吞吐率是指流水线在单位时间里所完成的任务数或输出的结果数。设某流水线有5段，有1段的时间为2ns，另外4段的每段时间为1ns，利用此流水线完成100个任务的吞吐率约为（ ）个/s。**
A.500×10⁶
B.490×10⁶
C.250×10⁶
D.167×10⁶

**答案：B**
解析：流水线吞吐率由最长段时间决定（2ns）。
1. **总执行时间计算**：
   - 第一个任务耗时：2+1+1+1+1=6ns（所有段完成）
   - 后续99个任务：每个仅需2ns（最长段时间）
   - 总时间=6ns + 99×2ns=204ns
2. **单位换算**：204ns=204×10⁻⁹s
3. **吞吐率计算**：100任务 / 204×10⁻⁹s ≈4.9×10⁸任务/s=490×10⁶任务/s
（注：原答案选项A为计算近似值，精确结果应为选项B）

#### 题目4
**假设磁盘块与缓冲区大小相同，每个盘块读入缓冲区的时间为15us，由缓冲区送至用户区的时间是5us，在用户区内系统对每块数据的处理时间为1us。若用户需要将大小为10个磁盘块的Doc1文件逐块从磁盘读入缓冲区，并送至用户区进行处理，那么采用单缓冲区需要花费的时间为（ ）us；采用双缓冲区需要花费的时间为（ ）us。**
A.150
B.151
C.156
D.201

**答案：第一空选D，第二空选C**
解析：

单缓冲区工作原理（串行执行）

- **第一块耗时**：读入(15us)→传输(5us)→处理(1us) = 21us
- **后续9块耗时**：每块需等待前一块完成传输才能开始读入
  总时间=21us + 9×(15us+5us) = 21+180=201us

双缓冲区工作原理（并行执行）

- 读入新块与处理旧块可并行
- **总时间**=读入全部块时间+最后一块传输+最后一块处理
  =15us×10 +5us+1us=156us

#### 题目5
**流水线技术是通过并行硬件来提高系统性能的常用方法。对于一个k段流水线，假设其各段的执行时间均相等（设为t），输入到流水线中的任务是连续的理想情况下，完成n个连续任务需要的总时间为（ ）。若某流水线浮点加法运算器分为5段，所需要的时间分别是6ns、7ns、8ns、9ns和6ns，则其最大加速比为（ ）。**
A.nkt
B.(k+n-1)t
C.(n-k)kt
D.(k+n+1)t

A.4
B.5
C.6
D.7

**答案：第一空选B，第二空选A**
解析：

第一空：流水线总时间公式推导

- **非流水线时间**：n个任务×k段×t = nkt
- **流水线时间**：
  1. 第一个任务：k段×t = kt
  2. 后续n-1个任务：每个仅需t（段并行）
  3. 总时间=kt + (n-1)t = (k+n-1)t

第二空：最大加速比计算

1. **非流水线执行时间**：6+7+8+9+6=36ns
2. **流水线周期**：最长段时间=9ns
3. **n任务流水线时间**：5×9 + (n-1)×9 = 9n+36ns
4. **加速比公式**：非流水线时间/流水线时间
   当n→∞时，加速比≈36n/(9n)=4

## 5. 存储系统

### 5.1 存储系统的层次结构

存储系统采用**分层结构**设计，旨在解决速度、容量和成本之间的矛盾。按速度从快到慢、容量从小到大、成本从高到低排序，典型的存储层次包括：

| 层次 | 存储设备 | 访问速度 | 存储容量 | 成本/位 | 作用 |
|------|----------|----------|----------|---------|------|
| 寄存器 | CPU内部寄存器 | 最快(ns级) | 最小 | 最高 | 临时数据存储 |
| 高速缓存(Cache) | SRAM | 几ns | 小(KB-MB) | 高 | 缓解CPU与内存速度差异 |
| 主存储器 | DRAM | 几十ns | 中等(GB) | 中 | 程序和数据的主要存放区域 |
| 外存储器 | HDD/SSD | 几ms | 大(TB) | 低 | 长期数据存储 |
| 离线存储 | 光盘/磁带 | 最慢 | 最大 | 最低 | 数据备份归档 |

### 5.2 主存储器

#### 5.2.1 半导体存储器分类

半导体存储器可分为**随机存取存储器(RAM)**和**只读存储器(ROM)**两大类：

1. **随机存取存储器(RAM)**
   - **静态RAM(SRAM)**：采用双稳态触发器存储信息，不需要刷新，速度快，集成度低，功耗大，常用于Cache
   - **动态RAM(DRAM)**：利用电容存储电荷，需要定期刷新(通常每2ms)，集成度高，功耗小，价格低，用于主存

2. **只读存储器(ROM)**
   - **掩模ROM(MROM)**：由生产厂家在制造时写入数据，不可修改
   - **可编程ROM(PROM)**：用户可写入一次，不可擦除
   - **可擦除可编程ROM(EPROM)**：通过紫外线擦除，可多次编程
   - **电可擦除可编程ROM(EEPROM)**：通过电信号擦除，可在线编程
   - **闪存(Flash Memory)**：介于EPROM和EEPROM之间，可快速擦除和重写

#### 5.2.2 主存储器的技术指标

1. **存储容量**：指存储器能存储的二进制信息总量，通常以字节(Byte)为单位
2. **存取时间**：从发出读写命令到完成数据存取所需的时间
3. **存储周期**：连续两次独立的存储器操作之间所需的最短时间
4. **带宽**：单位时间内存储器能传输的数据量，通常以字节/秒(Byte/s)为单位

### 5.3 高速缓存(Cache)

#### 5.3.1 Cache的基本原理

Cache是位于CPU和主存之间的一种高速缓冲存储器，用于**缓解CPU与主存之间的速度差异**。其基本原理是**程序访问的局部性原理**，包括时间局部性和空间局部性：

- **时间局部性**：最近被访问的数据很可能在不久的将来再次被访问
- **空间局部性**：被访问的数据附近的数据很可能在不久的将来被访问

#### 5.3.2 Cache的映射方式

Cache与主存之间的数据映射方式有三种：

1. **直接映射**
   - 每个主存块只能映射到Cache的特定块
   - 实现简单，成本低，但冲突概率高
   - 映射公式：Cache块号 = 主存块号 mod Cache块数

2. **全相联映射**
   - 每个主存块可以映射到Cache的任意块
   - 冲突概率低，Cache利用率高，但实现复杂
   - 需要使用相联存储器和复杂的替换算法

3. **组相联映射**
   - 结合直接映射和全相联映射的优点
   - 将Cache分为若干组，每个主存块映射到固定组的任意块
   - 常用的有2路、4路、8路组相联等
   - 映射公式：Cache组号 = 主存块号 mod Cache组数

#### 5.3.3 Cache的替换算法

当Cache已满，需要替换时，常用的替换算法包括：

1. **随机替换(RAND)**：随机选择一个Cache块进行替换
2. **先进先出(FIFO)**：选择最早调入Cache的块进行替换
3. **最久未使用(LRU)**：选择最长时间未被访问的块进行替换
4. **近期最少使用(LFU)**：选择访问次数最少的块进行替换
5. **优化替换(OPT)**：选择未来最长时间内不会被访问的块进行替换(理论最优，实际无法实现)

#### 5.3.4 Cache的性能指标

Cache的主要性能指标是**命中率**和**平均访问时间**：

- **命中率(h)**：CPU访问Cache命中的次数占总访问次数的比例
- **平均访问时间(T)**：T = h×Tc + (1-h)×Tm，其中Tc为Cache访问时间，Tm为主存访问时间

### 5.4 虚拟内存

#### 5.4.1 虚拟内存的基本原理

虚拟内存是一种**内存管理技术**，通过硬件和软件的配合，将主存和外存结合起来，为用户提供一个比实际主存大得多的虚拟地址空间。其基本原理是**局部性原理**和**分页/分段存储管理**。

#### 5.4.2 页式虚拟内存

页式虚拟内存将虚拟地址空间和物理地址空间均划分为固定大小的块，分别称为**页(Page)**和**页框(Page Frame)**。页和页框的大小通常为4KB、8KB、16KB等。

1. **页表**：用于记录虚拟页号到物理页框号的映射关系
2. **快表(TLB)**：位于CPU内部的高速缓存，用于存放当前最常用的页表项
3. **缺页中断**：当程序访问的页不在主存时，产生缺页中断，操作系统将该页从外存调入主存

#### 5.4.3 段式虚拟内存

段式虚拟内存根据程序的逻辑结构，将虚拟地址空间划分为不同大小的段，如代码段、数据段、堆栈段等。

1. **段表**：用于记录段号到物理地址的映射关系，包括段基址、段长度、访问权限等
2. **段的特点**：保持程序的逻辑结构，便于程序的共享和保护

#### 4.4 段页式虚拟内存

段页式虚拟内存结合了页式和段式的优点，先将程序按逻辑结构分段，再将每段分页。

1. **段表**：记录每段的页表起始地址
2. **页表**：记录每页的物理页框号
3. **地址转换过程**：虚拟地址→段号+段内页号+页内偏移→查段表→查页表→物理地址

### 5.5 外存储器

#### 5.5.1 磁表面存储器

1. **硬盘存储器(HDD)**
   - **组成**：盘片、磁头、主轴、控制电路等
   - **技术指标**：存储容量、转速、平均寻道时间、平均等待时间、数据传输率等
   - **数据存取过程**：寻道→旋转延迟→数据传输

2. **磁带存储器**
   - 顺序存取设备，速度慢，但容量大、成本低，常用于数据备份

#### 5.5.2 光存储器

1. **CD-ROM**：只读光盘，容量约650MB
2. **CD-R/RW**：可记录/可重写光盘
3. **DVD-ROM**：数字多功能光盘，容量约4.7GB
4. **蓝光光盘(BD)**：容量可达25GB(单层)或50GB(双层)

#### 5.5.3 固态硬盘(SSD)

1. **组成**：闪存芯片、控制芯片、缓存芯片等
2. **特点**：速度快、无机械部件、功耗低、抗震性好，但价格较高，寿命有限
3. **常见接口**：SATA、PCIe、M.2等

### 5.6 存储系统的可靠性

存储系统的可靠性通常用**平均无故障时间(MTBF)**和**平均故障修复时间(MTTR)**来衡量。为提高可靠性，常采用**冗余技术**，如：

1. **奇偶校验**：用于检测一位错误
2. **海明码**：可检测两位错误并纠正一位错误
3. **循环冗余校验(CRC)**：可检测多位错误
4. **RAID技术**：通过数据条带化、镜像和校验等方式提高存储系统的可靠性和性能

### 5.7 考试真题解析

#### 题目1
**某计算机系统的内存由Cache和主存构成，Cache的存取周期为45ns，主存的存取周期为200ns。已知在一段时间内，CPU共访问内存4500次，其中340次访问Cache失败，则Cache的命中率是（ ）。**
A. 92.4%
B. 88.2%
C. 90.1%
D. 95.3%

**答案：A**
解析：
- Cache命中次数 = 总访问次数 - 失败次数 = 4500 - 340 = 4160次
- 命中率 = 命中次数 / 总访问次数 × 100% = 4160 / 4500 × 100% ≈ 92.4%

#### 题目2
**在页式存储管理中，若地址用20位二进制表示，页大小为2KB，则允许的最大页数为（ ）。**
A. 1024
B. 2048
C. 512
D. 4096

**答案：D**
解析：
- 页大小 = 2KB = 2^11字节
- 地址总位数 = 20位
- 页号位数 = 总位数 - 页内偏移位数 = 20 - 11 = 9位
- 最大页数 = 2^9 = 512（注：此处原解析有误，正确计算应为：页内偏移位数=log2(2KB)=log2(2^11)=11位，页号位数=20-11=9位，最大页数=2^9=512，选项中无正确答案，可能题目或选项有误。但按照提供选项，推测题目可能存在不同条件，正确选项为D。）

#### 题目3
**以下关于Cache替换算法的描述中，错误的是（ ）。**
A. 先进先出算法(FIFO)可能会导致 Belady现象
B. 最久未使用算法(LRU)是一种堆栈算法，不会出现Belady现象
C. 优化替换算法(OPT)可以获得最高的Cache命中率
D. 近期最少使用算法(LFU)是根据页面的访问次数来选择替换的

**答案：B**
解析：
- Belady现象：增加Cache容量时，命中率反而下降的现象
- FIFO算法会出现Belady现象，而堆栈算法(如LRU、LFU)不会
- OPT算法是理论最优算法，但实际无法实现
- LFU算法确实是根据页面的访问次数来选择替换的

#### 题目4
**在磁盘存取过程中，影响存取时间的因素主要有（ ）。**
A. 寻道时间、旋转延迟时间、传输时间
B. 寻道时间、等待时间、传输时间
C. 寻道时间、旋转延迟时间、等待时间
D. 旋转延迟时间、传输时间、等待时间

**答案：A**
解析：
- 磁盘存取时间 = 寻道时间 + 旋转延迟时间 + 传输时间
- 寻道时间：磁头移动到指定磁道所需的时间
- 旋转延迟时间：等待指定扇区旋转到磁头下方所需的时间
- 传输时间：数据从磁盘传输到内存所需的时间

#### 题目5
**某计算机系统中，内存地址与物理地址都是32位，页表项大小为4字节。若使用一级页表结构，假设页面大小为4KB，则页表的大小为（ ）。**
A. 4MB
B. 8MB
C. 16MB
D. 32MB

**答案：A**
解析：
- 页面大小 = 4KB = 2^12字节
- 页内偏移位数 = log2(4KB) = 12位
- 页号位数 = 32 - 12 = 20位
- 页表项数量 = 2^20 = 1,048,576项
- 页表大小 = 页表项数量 × 页表项大小 = 1,048,576 × 4字节 = 4,194,304字节 = 4MB

