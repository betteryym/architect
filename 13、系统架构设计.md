# 软件架构概述

从需求分析到软件设计之间的过渡过程称为软件架构。只要软件架构设计好了，整个软件就不会出现坍塌性的错误，即不会崩溃。

架构设计就是需求分配，将满足需求的职责分配到组件上。

软件架构为软件系统提供了一个结构、行为和属性的高级抽象，由构件的描述、构件的相互作用（连接件）、指导构件集成的模式以及这些模式的约束组成。

软件架构不仅指定了系统的组织结构和拓扑结构，并且显示了系统需求和构件之间的对应关系，提供了一些设计决策的基本原理。

解决好软件的复用、质量和维护问题，是研究软件架构的基本目的。

软件架构设计包括提出架构模型，产生架构设计和进行设计评审等活动，是一个迭代的过程。架构设计主要关注软件组件的结构、属性和交互作用，并通过多种视图全面描述特定系统的架构。

软件架构能够在设计变更相对容易的阶段，考虑系统结构的可选方案，便于技术人员与非技术人员就软件设计进行交互，能够展现软件的结构、属性与内部交互关系。

软件架构是项目干系人进行交流的手段，明确了对系统实现的约束条件，决定了开发和维护组织的组织结构，制约着系统的质量属性。

软件架构使推理和控制的更改更加简单，有助于循序渐进的原型设计，可以作为培训的基础。

软件架构是可传递和可复用的模型，通过研究软件架构可能预测软件的质量。

# 软件架构设计与生命周期

## 1. 需求分析阶段
需求分析和SA设计面临的是不同的对象：一个是问题空间；另一个是解空间。从软件需求模型向SA模型的转换主要关注两个问题：如何根据需求模型构建SA模型；如何保证模型转换的可追踪性。

## 2. 设计阶段
是SA（软件架构）研究关注的最早和最多的阶段，这一阶段的SA研究主要包括：SA模型的描述、SA模型的设计与分析方法，以及对SA设计经验的总结与复用等。有关SA模型描述的研究分为3个层次：SA的基本概念（构件和连接子）、体系结构描述语言ADL、SA模型的多视图表示。

## 3. 实现阶段
最初SA研究往往只关注较高层次的系统设计、描述和验证。为了有效实现SA设计向实现的转换，实现阶段的体系结构研究表现在以下几个方面：
(1) 研究基于SA的开发过程支持，如项目组织结构、配置管理等。
(2) 寻求从SA向实现过渡的途径，如将程序设计语言元素引入SA阶段、模型映射、构件组装、复用中间件平台等。
(3) 研究基于SA的测试技术。

## 4. 构件组装阶段
在SA设计模型的指导下，可复用构件的组装可以在较高层次上实现系统，并能够提高系统实现的效率。在构件组装的过程中，SA设计模型起到了系统蓝图的作用。研究内容包括如下两个方面：
(1) 如何支持可复用构件的互联，即对SA设计模型中规定的连接子的实现提供支持。
(2) 在组装过程中，如何检测并消除体系结构失配问题。
在构件组装阶段的失配问题主要包括：由构件引起的失配、由连接子引起的失配、由于系统成分对全局体系结构的假设存在冲突引起的失配等。

## 5. 部署阶段

软件架构对软件部署的作用如下：

(1) 提供高层的体系结构视图来描述部署阶段的软硬件模型。
(2) 基于SA模型可以分析部署方案的质量属性，从而选择合理的部署方案。

## 6. 后开发阶段
是指软件部署安装之后的阶段。这一阶段的SA研究主要围绕维护、演化、复用等方面来进行。典型的研究方向包括动态软件体系结构、体系结构恢复与重建等。
(1) 动态软件体系结构。现实中的软件具有动态性，体系结构会在运行时发生改变。运行时变化包括两类：软件内部执行所导致的体系结构改变；软件系统外部的请求对软件进行的重配置。
(2) 体系结构恢复与重建。对于没有系统的开发、运行时测量基础设施的情况，从这些系统中恢复或重构体系结构。从已有的系统中获取体系结构的重建方法分为4类：手工体系结构重建、工具支持的手工重建、通过查询语言来自动建立聚集、使用其他技术（如数据挖掘等）。

# 构件

构件是一个独立可交付的功能单元，外界通过接口访问其提供的服务。

构件由一组通常需要同时部署的原子构件组成。一个原子构件是一个模块和一组资源。原子构件是部署、成本控制和替换的基本单位。原子构件通常成组地部署，但是它也能够被单独部署。尽管它们可以被单独部署，但是，大多数原子构件永远都不会被单独部署，部署往往涉及整个家族。

一个模块是不带单独资源的原子构件。

一个单独的包被编译成多个单独的类文件——每个公共类都有一个。

模块是一组类和可能的非面向对象的结构体，比如过程或者函数。

## 构件的特性
(1) 独立部署单元；
(2) 作为第三方的组装单元；
(3) 没有（外部的）可见状态。
一个构件可以包含多个元素，但是一个类元素只能属于一个构件。将一个类拆分进行部署通常没什么意义。

## 构件的实例（对象）
(1) 一个实例单元，具有唯一的标志。
(2) 可能具有状态，此状态外部可见。
(3) 封装了自己的状态和行为。

## 构件接口
接口标准化是对接口中消息的格式、模式和协议的标准化。它不是要将接口格式化为参数化操作的集合，而是关注输入输出的消息的标准化，它强调当机器在网络中互连时，标准的消息模式、格式、协议的重要性。

## 面向构件的编程（COP）
关注向构件程序员提供构件内的解决方案。面向构件的编程需要下列基本的支持：
- 多态性（可替代性）；
- 模块封装性（高层次信息的隐藏）；
- 后期的绑定和装载（部署独立性）；
- 安全性（类型和模块安全性）。

## 国际构件标准

构件技术就是利用某种编程手段，将一些人们所关心的，但又不便于让最终用户去直接操作的细节进行了封装，同时对各种业务逻辑规则进行了实现，用于处理用户的内部操作细节。目前国际上常见的构建标准主要有三大流派。

### EJB(Enterprise Java Bean)
EJB规范由Sun公司制定，有三种类型的EJB，分别是会话Bean(Session Bean)、实体Bean(Entity Bean)和消息驱动Bean(Message-driven Bean)。EJB实现应用中关键的业务逻辑，创建基于构件的企业级应用程序。

### COM、DCOM、COM+
COM是微软公司的。DCOM是COM的进一步扩展，具有位置独立性和语言无关性。COM+并不是COM的新版本，是COM的新发展或是更高层次的应用。

### CORBA
CORBA标准主要分为三个层次：对象请求代理、公共对象服务和公共设施。
最底层是对象请求代理ORB，规定了分布对象的定义（接口）和语言映射，实现对象间的通讯和互操作，是分布对象系统中的“软总线”；
在ORB之上定义了很多公共服务，可以提供诸如并发服务、名字服务、事务（交易）服务、安全服务等各种各样的服务；
最上层的公共设施则定义了组件框架，提供可直接为业务对象使用的服务，规定业务对象有效协作所需的协定规则。

# 架构风格

软件架构风格是描述某一特定应用领域中系统组织方式的惯用模式。架构风格定义一个系统家族，即一个架构定义一个词汇表和一组约束。词汇表中包含一些构件和连接件类型，而这组约束指出系统是如何将这些构件和连接件组合起来的。

架构风格反映了领域中众多系统所共有的结构和语义特性，并指导如何将各个模块和子系统有效地组织成一个完整的系统。对软件架构风格的研究和实践促进对设计的重用。

架构设计的一个核心问题是能否达到架构级的软件复用。

架构风格定义了用于描述系统的术语表和一组指导构建系统的规则。

## 1. 数据流风格
### 批处理序列
每一步处理数据，全部的输入数据都被输入，然后产生完整的输出。
如编译器、传统的信息系统。

### 管道/过滤器
每个构件都有一组输入和输出，构件接受数据输入，然后产生数据输出。
如UNIX shell脚本，传统的编译器。

## 2. 调用/返回风格
### 主程序/子程序
如C程序。

### 面向对象风格
对象是抽象数据类型的实例。
如Java。

### 层次结构
每层为上层提供服务，使用下层提供的服务，同时该层知道如何组织下层。
如TCP/IP协议栈。

## 3. 独立构件风格
### 进程通信
构件是独立的进程，构件间通过消息传递交互。
如IPC。

### 事件系统
构件不直接调用一个过程，而是发布一个或多个事件。系统中的其他构件可注册相关的事件，事件的发布触发这些构件中相应的事件处理过程。
如Windows的事件驱动。

## 4. 虚拟机风格
### 解释器
包括一个完成解释工作的解释引擎，以及一个包含将被解释的代码的存储区。
如JavaScript解释器。

### 基于规则的系统
包括规则集、规则解释器、规则/数据选择器和工作内存。
如专家系统。

## 5. 仓库风格
### 数据库系统
### 超文本系统
### 黑板系统
黑板系统由知识源、黑板数据结构和控制三部分组成。黑板系统解决问题时，首先知识源竞争使用黑板上的数据，然后将结果写回黑板。
黑板数据结构起到在知识源之间传递信息的作用。

# 软件架构设计方法

软件架构设计主要关注软件系统的质量属性、功能需求和约束。

## 1. 架构需求说明
架构需求说明是架构设计的输入，对架构设计的质量具有至关重要的影响。架构需求主要来自三个方面：
(1) 系统的质量需求（非功能需求）
(2) 系统的功能需求
(3) 业务领域对系统架构的约束

## 2. 架构设计方法
### 主要设计方法
(1) 核心迭代法
(2) 数据流法
(3) 用例驱动法
(4) 模式驱动法
(5) 领域驱动设计
(6) 基于构件的开发方法
(7) 产品线方法

# 系统架构评估

## 1. 架构评估的目标
架构评估的主要目标是评估软件架构是否满足需求，包括功能需求和非功能需求（如性能、安全性、可扩展性等）。

## 2. 架构评估的方法
### SAAM(架构权衡分析方法)
SAAM是一种最早的软件架构评估方法，它主要关注架构对需求的满足程度。SAAM的过程包括：场景开发、架构描述、场景分类与优先级确定、间接场景评估、场景交互评估、总体评估。

### ATAM(架构权衡分析方法)
ATAM是一种更全面的架构评估方法，它考虑了多个质量属性之间的权衡。ATAM的过程包括：介绍ATAM方法、介绍业务驱动因素、介绍架构、识别架构方法、生成质量属性效用树、分析架构方法、讨论和分级场景、提出分析结果。

### CBAM(基于成本的评估方法)
CBAM是一种基于成本效益分析的架构评估方法，它帮助决策者选择最具成本效益的架构。

## 3. 架构评估的质量属性
(1) 性能：系统的响应时间、吞吐量等。
(2) 可用性：系统正常运行的时间比例。
(3) 安全性：系统防止未授权访问和数据泄露的能力。
(4) 可扩展性：系统适应增长需求的能力。
(5) 可维护性：系统易于维护和修改的程度。
(6) 可靠性：系统在给定时间内正常运行的概率。
(7) 可测试性：系统易于测试的程度。

# 架构文档

## 1. 架构文档的作用
(1) 为项目干系人提供一个共同的理解基础。
(2) 指导后续的开发和维护工作。
(3) 便于系统的评估和改进。

## 2. 架构文档的内容
(1) 架构概述：描述系统的总体架构和主要组件。
(2) 架构约束：描述架构设计的约束条件。
(3) 组件描述：详细描述系统的各个组件。
(4) 交互描述：描述组件之间的交互方式。
(5) 质量属性：描述系统的质量属性和如何实现这些质量属性。
(6) 部署视图：描述系统的部署方式。

## 3. 架构文档的视图
### 4+1视图模型
(1) 逻辑视图：描述系统的功能需求，包括类、对象和它们之间的关系。
(2) 进程视图：描述系统的并发特性，包括进程、线程和它们之间的通信。
(3) 物理视图：描述系统的物理部署，包括硬件、软件和它们之间的关系。
(4) 开发视图：描述系统的开发组织，包括子系统、包和它们之间的关系。
(5) 用例视图：将上述四个视图联系起来，描述系统如何满足用户需求。

# 真题

## 真题1：架构风格
某软件系统能够根据用户的输入命令，将数据处理的结果实时显示在屏幕上。该系统应该采用哪种架构风格？
A. 批处理序列
B. 管道/过滤器
C. 事件系统
D. 仓库系统
答案：C。解析：事件系统适用于需要实时响应用户输入的场景，系统中的构件通过发布事件和注册事件处理器来实现交互。

## 真题2：中间件
以下哪项不是中间件的主要类型？
A. 消息中间件
B. 事务中间件
C. 分布式对象中间件
D. 数据库中间件
答案：D。解析：中间件的主要类型包括消息中间件、事务中间件、分布式对象中间件和应用服务器。

## 真题3：三层架构
三层架构中的业务逻辑层负责：
A. 与用户交互
B. 处理业务逻辑
C. 与数据库交互
D. 提供网络服务
答案：B。解析：三层架构包括表示层（负责与用户交互）、业务逻辑层（负责处理业务逻辑）和数据访问层（负责与数据库交互）。

## 真题4：软件架构
软件架构设计的主要目的是：
A. 确定系统的功能需求
B. 确定系统的性能需求
C. 解决软件的复用、质量和维护问题
D. 确定系统的开发团队
答案：C。解析：解决好软件的复用、质量和维护问题，是研究软件架构的根本目的。

# 中间件

中间件是位于硬件、操作系统等平台和应用之间的通用服务。

## 中间件的分类
(1) 消息中间件
(2) 事务中间件
(3) 分布式对象中间件
(4) 应用服务器

### 消息中间件
消息中间件利用高效可靠的消息传递机制进行平台无关的数据交流，并基于数据通信来进行分布式系统的集成。
消息中间件适用于需要可靠的数据传送的分布式环境。采用消息中间件，如IBM的MQSeries，可以满足大量数据传输的需要，可以将数据缓冲排队，可以保证数据不丢失，提高系统的可靠性。

### 事务中间件
事务中间件，也称为事务处理监控器(TPM)，可以为应用提供一个事务处理的框架。这个框架可以保证事务的完整性和一致性，保证事务可以正确地提交或回滚。

### 分布式对象中间件
分布式对象中间件是建立在分布式计算技术和面向对象技术基础上的一种中间件。它允许不同应用、不同平台、不同语言的对象之间进行通信和调用。

### 应用服务器
应用服务器是指通过各种协议把商业逻辑曝露给客户端的程序。它提供了一个应用程序的运行环境，如Web容器、EJB容器等。

# 典型应用架构

## 1. 层次架构
在层次架构中，系统被组织成一个层次结构，每一层都为上层提供服务，同时使用下层提供的服务。每一层的变化不会影响其他层，只要接口保持不变。

## 2. 客户端-服务器架构
客户端-服务器架构是一种分布式架构，它将系统分为客户端和服务器两部分。客户端负责与用户交互，服务器负责处理数据和业务逻辑。

## 3. 三层架构
三层架构包括表示层、业务逻辑层和数据访问层。表示层负责与用户交互，业务逻辑层负责处理业务逻辑，数据访问层负责与数据库交互。

## 4. 多层架构
多层架构是三层架构的扩展，它将系统分为更多的层，如表示层、应用层、业务逻辑层、数据访问层等。

## 5. 微服务架构
微服务架构是一种将应用程序构建为一系列松耦合服务的方法。每个服务运行在自己的进程中，并通过轻量级机制（通常是HTTP API）进行通信。